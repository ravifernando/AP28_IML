// cpuconst.h

extern uint64_t *n43_h;

#if defined(__aarch64__)
  int64x2_t svec1, svec2, mvec1, mvec2, numvec1_1, numvec2_1, numvec1_2, numvec2_2;
#else
  extern __m128i svec1, svec2, mvec1, mvec2, numvec1_1, numvec2_1, numvec1_2, numvec2_2;
  extern __m256i svec, mvec, numvec1, numvec2;
#endif

#if !defined(__aarch64__)
extern char OK61[61];
extern char OK67[67];
extern char OK71[71];
extern char OK73[73];
extern char OK79[79];
extern char OK83[83];
extern char OK89[89];
extern char OK97[97];
extern char OK101[101];
extern char OK103[103];
extern char OK107[107];
extern char OK109[109];
extern char OK113[113];
extern char OK127[127];
extern char OK131[131];
extern char OK137[137];
extern char OK139[139];
extern char OK149[149];
extern char OK151[151];
extern char OK157[157];
extern char OK163[163];
extern char OK167[167];
extern char OK173[173];
extern char OK179[179];
extern char OK181[181];
extern char OK191[191];
extern char OK193[193];
extern char OK197[197];
extern char OK199[199];
extern char OK211[211];
extern char OK223[223];
extern char OK227[227];
extern char OK229[229];
extern char OK233[233];
extern char OK239[239];
extern char OK241[241];
extern char OK251[251];
extern char OK257[257];
extern char OK263[263];
extern char OK269[269];
extern char OK271[271];
extern char OK277[277];
extern char OK281[281];
extern char OK283[283];
extern char OK293[293];
extern char OK307[307];
extern char OK311[311];
extern char OK313[313];
extern char OK317[317];
extern char OK331[331];
extern char OK337[337];
extern char OK347[347];
extern char OK349[349];
extern char OK353[353];
extern char OK359[359];
extern char OK367[367];
extern char OK373[373];
extern char OK379[379];
extern char OK383[383];
extern char OK389[389];
extern char OK397[397];
extern char OK401[401];
extern char OK409[409];
extern char OK419[419];
extern char OK421[421];
extern char OK431[431];
extern char OK433[433];
extern char OK439[439];
extern char OK443[443];
extern char OK449[449];
extern char OK457[457];
extern char OK461[461];
extern char OK463[463];
extern char OK467[467];
extern char OK479[479];
extern char OK487[487];
extern char OK491[491];
extern char OK499[499];
extern char OK503[503];
extern char OK509[509];
extern char OK521[521];
extern char OK523[523];
extern char OK541[541];

extern __m128i ixOKOK61[61];
extern __m128i ixOKOK67[67];
extern __m128i ixOKOK71[71];
extern __m128i ixOKOK73[73];
extern __m128i ixOKOK79[79];
extern __m128i ixOKOK83[83];
extern __m128i ixOKOK89[89];
extern __m128i ixOKOK97[97];
extern __m128i ixOKOK101[101];
extern __m128i ixOKOK103[103];
extern __m128i ixOKOK107[107];
extern __m128i ixOKOK109[109];
extern __m128i ixOKOK113[113];
extern __m128i ixOKOK127[127];
extern __m128i ixOKOK131[131];
extern __m128i ixOKOK137[137];
extern __m128i ixOKOK139[139];
extern __m128i ixOKOK149[149];
extern __m128i ixOKOK151[151];
extern __m128i ixOKOK157[157];
extern __m128i ixOKOK163[163];
extern __m128i ixOKOK167[167];
extern __m128i ixOKOK173[173];
extern __m128i ixOKOK179[179];
extern __m128i ixOKOK181[181];
extern __m128i ixOKOK191[191];
extern __m128i ixOKOK193[193];
extern __m128i ixOKOK197[197];
extern __m128i ixOKOK199[199];
extern __m128i ixOKOK211[211];
extern __m128i ixOKOK223[223];
extern __m128i ixOKOK227[227];
extern __m128i ixOKOK229[229];
extern __m128i ixOKOK233[233];
extern __m128i ixOKOK239[239];
extern __m128i ixOKOK241[241];
extern __m128i ixOKOK251[251];
extern __m128i ixOKOK257[257];
extern __m128i ixOKOK263[263];
extern __m128i ixOKOK269[269];
extern __m128i ixOKOK271[271];
extern __m128i ixOKOK277[277];

extern __m256d xOKOK61[61];
extern __m256d xOKOK67[67];
extern __m256d xOKOK71[71];
extern __m256d xOKOK73[73];
extern __m256d xOKOK79[79];
extern __m256d xOKOK83[83];
extern __m256d xOKOK89[89];
extern __m256d xOKOK97[97];
extern __m256d xOKOK101[101];
extern __m256d xOKOK103[103];
extern __m256d xOKOK107[107];
extern __m256d xOKOK109[109];
extern __m256d xOKOK113[113];
extern __m256d xOKOK127[127];
extern __m256d xOKOK131[131];
extern __m256d xOKOK137[137];
extern __m256d xOKOK139[139];
extern __m256d xOKOK149[149];
extern __m256d xOKOK151[151];
extern __m256d xOKOK157[157];
extern __m256d xOKOK163[163];
extern __m256d xOKOK167[167];
extern __m256d xOKOK173[173];
extern __m256d xOKOK179[179];
extern __m256d xOKOK181[181];
extern __m256d xOKOK191[191];
extern __m256d xOKOK193[193];
extern __m256d xOKOK197[197];
extern __m256d xOKOK199[199];
extern __m256d xOKOK211[211];
extern __m256d xOKOK223[223];
extern __m256d xOKOK227[227];
extern __m256d xOKOK229[229];
extern __m256d xOKOK233[233];
extern __m256d xOKOK239[239];
extern __m256d xOKOK241[241];
extern __m256d xOKOK251[251];
extern __m256d xOKOK257[257];
extern __m256d xOKOK263[263];
extern __m256d xOKOK269[269];
extern __m256d xOKOK271[271];
extern __m256d xOKOK277[277];
#endif


/////////////////////////////
// main lock for search data
extern int current_n43;
extern pthread_mutex_t lock1;
/////////////////////////////

///////////////////////////////////
// lock used for writing results to file
extern pthread_mutex_t lock2;
///////////////////////////////////

///////////////////////////////////
// lock used for checksum and ap count
extern uint32_t totalaps;
extern uint32_t cksum;
extern pthread_mutex_t lock3;
///////////////////////////////////


typedef struct _thread_data_t {
	uint64_t STEP, S43, S47, S53, S59;
	int id, K, SHIFT, iteration, K_COUNT, K_DONE;
} thread_data_t;


// located in AP26.cpp
extern void Progress(double prog);
extern void ReportSolution(int AP_Length, int difference, uint64_t First_Term, uint32_t & checksum);
extern bool PrimeQ(uint64_t N);
extern int boinc_standalone(void);
extern void ckerr(int err);


#define thread_range 50
#define numn43s	10840
#define MAXINTV 2000000000


#define PRIM23	UINT64_C(223092870)
#define PRIME1	29
#define PRIME2	31
#define PRIME3	37
#define PRIME4	41
#define PRIME5	43
#define PRIME6	47
#define PRIME7	53
#define PRIME8	59
#define MOD		UINT64_C(258559632607830)
#define N0		UINT64_C(106990415896110)
#define N30		UINT64_C(94805198622871)
#define S3		UINT64_C(172373088405220)
#define S5		UINT64_C(51711926521566)
#define PRES2	UINT64_C(16681266619860)
#define PRES3	UINT64_C(181690552643340)
#define PRES4	UINT64_C(132432982555230)
#define PRES5	UINT64_C(126273308948010)
#define PRES6	UINT64_C(115526644356690)
#define PRES7	UINT64_C(48784836341100)
#define PRES8	UINT64_C(100794433050510)

/* These constants were generated with the PARI/GP command:
     forprime(p=61,331,print("#define INV",p," UINT64_C(",2^64\p,")"))
*/
#define INV61 UINT64_C(302405640552615600)
#define INV67 UINT64_C(275324538413575397)
#define INV71 UINT64_C(259813296812810586)
#define INV73 UINT64_C(252695124297391118)
#define INV79 UINT64_C(233503089540627235)
#define INV83 UINT64_C(222249928598910260)
#define INV89 UINT64_C(207266787345051141)
#define INV97 UINT64_C(190172619316593315)
#define INV101 UINT64_C(182641030432767837)
#define INV103 UINT64_C(179094602657374287)
#define INV107 UINT64_C(172399477324388332)
#define INV109 UINT64_C(169236184162472950)
#define INV113 UINT64_C(163245522776190722)
#define INV127 UINT64_C(145249953336295682)
#define INV131 UINT64_C(140814840257324821)
#define INV137 UINT64_C(134647766961383588)
#define INV139 UINT64_C(132710389019493177)
#define INV149 UINT64_C(123803651501406386)
#define INV151 UINT64_C(122163868037811600)
#define INV157 UINT64_C(117495185182863386)
#define INV163 UINT64_C(113170209041162893)
#define INV167 UINT64_C(110459545351554201)
#define INV173 UINT64_C(106628578460748853)
#define INV179 UINT64_C(103054436165975148)
#define INV181 UINT64_C(101915713114417412)
#define INV191 UINT64_C(96579811904238490)
#define INV193 UINT64_C(95578984837873324)
#define INV197 UINT64_C(93638294790403815)
#define INV199 UINT64_C(92697206400550510)
#define INV211 UINT64_C(87425327363552377)
#define INV223 UINT64_C(82720825442643729)
#define INV227 UINT64_C(81263189752024456)
#define INV229 UINT64_C(80553467570784068)
#define INV233 UINT64_C(79170575423646144)
#define INV239 UINT64_C(77183029597111094)
#define INV241 UINT64_C(76542506529915151)
#define INV251 UINT64_C(73493004277727297)
#define INV257 UINT64_C(71777214294589695)
#define INV263 UINT64_C(70139711306880424)
#define INV269 UINT64_C(68575256779589411)
#define INV271 UINT64_C(68069166323651481)
#define INV277 UINT64_C(66594743948409933)


/* evaluates to (N%P), assuming N < 2^(64-S), P < 2^S.
*/
#define REM(_N,_P,_S) \
  (UINT32_C(_P)*(uint32_t)(((INV##_P*((uint64_t)(_N)+1))>>(32+_S))))>>(32-_S)


